### Branch 1 mongodb-set-up (cloud-based mongoDB)
- Login to mongoDB/ Create a db cluster [inventory-app]
- Connect
- whitelist IP address
- create user name
- auto-generate a password
- choose a connection method - local db or cloud-based db
- Get a connection string or URI - ``` mongodb+srv://user-name:<password>@cluster0-ox7di.mongodb.net/test?retryWrites=true&w=majority]```
- set up ORM mongoose to connect Express server to mongoDb cloud
- Manually test the db is connected

```
       mongoose.connect(
   'mongodb+srv://user-name:<auto-generated-password-pasted-here>@cluster0-ox7di.mongodb.net/test?retryWrites=true&w=majority',
   {
   	useNewUrlParser: true,
   	useCreateIndex: true,
   	useUnifiedTopology: true
   },
   (error) => {
   	if (!error) {
   		console.log('mongo-db connection working');
   	} else {
   		console.log('check mongo-db connection');
   	}
   }
);
mongoose.Promise = global.Promise;
```

- Check that files are not included
- To stop tracking a file that is currently tracked, use git rm --cached
set up .env files and ensure they are in gitignore files [ https://help.github.com/en/github/using-git/ignoring-files] / [https://git-scm.com/docs/gitignore]
username:password - remove ```<>``` which are placeholders

```
        require('dotenv/config');

        mongoose.connect(
	'process.env.DB_CONNECTION',
	{
		useNewUrlParser: true,
		useCreateIndex: true,
		useUnifiedTopology: true
	},
	() => {
		console.log('connected to mongoDb');
	}
);
```
A MongoDB database is one big object containing collections.
Each collection has contextual items, for example, contacts for a database.
Then inside a collection we have documents which are the contacts themselves.
User contact information would be in several indivdual documents.
Inside each document we have the data for each contact, such as address, telephone, email, et cetera.

The document, itself, looks like a JSON object with a key-value pair approach or arrays of data. Mongoose, middleware, allows us to set a schema for a collection and predefine what each key-value pair takes as type.

## Connect to MongoDB and the cloud in your App

### METHOD 1: Keeps database on your local machine and then connect to the cloud

The program is saved by default in the file path /usr/local/var/mongodb

1. Run the following command to ensure you have a place for mongo to store the data for your databases in a different filepath

```
sudo mkdir -p /data/db
```

The password prompt is for your laptop password

Now make sure you are permissioning the access to the db - this gives you permission to read and write to the directory

```
sudo chown -R $(whoami)/data/db
sudo chown -R $USER /data/db
```

note: whoamI/USER is not a place holder it finds you from your users directory, so check the directory path `/Users/xyz/Documents/` and see if you are the user or sudo make yourself the user

OR

```
sudo chown -R `id -un`/data/db
```

OR

```
sudo mongod --dbpath /Users/your_name_placeholder/data/db

<!-- eg - you can choose a username for read-write-accsss -->

sudo mongod --dbpath /Users/mongoDb/data/db
```

To check everything is working type mongod in the terminal. It will print a lot of stuff on the screen. After a few moments you should see this line at the bottom:

```
I NETWORK [thread1] waiting for connections on port 27017
```

If you get a socket in use error code 100 Catalina update stack overflow guidance
If the socket is already in use

- [https://stackoverflow.com/questions/47975929/socketexception-address-already-in-use-mongodb]
- [https://stackoverflow.com/questions/29813648/failed-to-unlink-socket-file-error-in-mongodb-3-0]
  You may want to remove the temporary socket and then run mongo or mongod as a command

```
sudo rm /tmp/mongodb-27017.sock
```

Here are some Catalina installation challenges - questions answered [https://stackoverflow.com/questions/58283257/mongodb-doesnt-work-on-latest-mac-os10-15] Here is a reddit thread [https://www.reddit.com/r/mongodb/comments/d7takd/macos_x_catalina_105_beta_and_mongo_a_warning/]

Some debugging on permissioning:

- [https://stackoverflow.com/questions/42446931/mongodb-exception-in-initandlisten-20-attempted-to-create-a-lock-file-on-a-rea]

Try running

```
sudo chmod -R a+wxr /data
```

Then

```
$ sudo mongod
```

In terminal Run a `show dbs` and you should see

```
MongoDB Enterprise > show dbs
admin   0.000GB
config  0.000GB
local   0.000GB
MongoDB Enterprise >
```

Now that you have your database up and running you are ready to create your collection, documents and schemas for your databases.

### METHOD 2: Keeps database in the cloud

1. Create a MongodB user name and password to use the Mongo cloud [https://account.mongodb.com/account/login] Then login with your user nameand password
2. Go to project, create new project, give project a name, check project owner and click set-up project
3. Prompt to set up cluster choose free shared cluster - clusters are groups of servers that store your data. You need this for each db you set up
4. Choose server (AWS, google cloud or azure) geographic region for the cluster (one close to your region good) and choose the sandbox option for the cluster tier, choose the free forever option for student projects, click create cluster
5. The cluster will be created, it takes a little while for the servers to be configured
6. Once created click on connect to create a new user
7. You will be prompted to add IP address this is to whitelist your IP address so that when you connect your local schemas to the cloud Db they will be linked and connected (save steps 7,8 and 9 somewhere so that you can access them for the project) You need to do this for each DB and save the key for each project

DEBUGGING - IF YOU USE A VPN YOUR IP WILL CHANGE SO GO TO THE CONFIGURATION AND ADD THE NEW IP ADDRESS AND SAVE IT - SO THAT YOU CAN SEE THE OLD AND NEW IP ADDRESSES THAT YOU HAVE WHIELISTED

8. Create your user name
9. Auto-generate a password, click show and save the password - if you lose this you will not be able to connect
10. Once you have saved all of the information you may require later, click add user
11. choose a connection method - option 3 - using compass
12. Get a connection string or URI
    `mongodb+srv://<username>:<password>@cluster0.xfd8y.mongodb.net/test`
    Replace `<username>` and `<password>` with the password and username you have stored in steps 8 and 9 (Save this string as well - make sure you have taken out the placeholder greater and less than signs around the username and password these are just placeholders)
13. Should you lose your place on the MongoCloud got back to click connect,
14. Now go back to your server to connect the local app to the db - check the mongo-and-express folder for details

